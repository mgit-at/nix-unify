module shareUsers || return

proc describe(; ; cfg) {
  d_t "share users"
  d_e (cfg)
}

const outSysusers = "/run/sysusers.d/nixos.conf"
const srcSysusers = "$etc/sysusers.d/00-nixos.conf"
const userState = "$state/userState"

proc final(; ; ctx, cfg) {
  if (cfg.enable) {
    mkdir -p "$(dirname "$outSysusers")"
    rm-link "$srcSysusers" "$outSysusers"
    systemd-sysusers "$outSysusers"
  }
}
